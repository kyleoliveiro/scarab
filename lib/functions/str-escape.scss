/// Escapes CSS special characters within a string. 
///
/// @group 5_functions
/// 
/// @requires {function} const
/// @requires {function} str-replace
/// @requires {function} list-contains
/// 
/// @link https://mathiasbynens.be/notes/css-escapes Notes on CSS escapes
///
/// @param  {String} $string - String to escape
/// 
/// @return {String}
///
/// @example
///   str-escape('_a:b!ðŸ˜€(b)c-d@')
///   // => '_a\3A b\!ðŸ˜€\(b\)c\-d\@'

@function str-escape($string) {
  $result: $string;
  $count: 0;

  @for $i from 1 through str-length($string) {
    $char: str-slice($string, $i, $i);

    // Escape special characters except `:` with a backslash
    @if list-contains(const(CSS, SPECIAL_CHARS), $char) and $char != ':' {
      $result: str-insert($result, '\\', ($i + $count));
      $count: $count + 1;
    }
  }

  // Escape `:` characters as `\3A `
  $result: str-replace($result, ':', '\\3A ', true);

  @return $result;
}
